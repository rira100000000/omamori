# frozen_string_literal: true

require 'sinatra'

# 危険な eval／動的コード実行の脆弱性を含むデモコード
# ユーザーからの入力を eval で直接評価している例

get '/calculate' do
  # ユーザーからの入力 (expression) を取得
  expression = params['expression']

  # 取得した入力を eval で評価
  # ここにコードインジェクションの脆弱性がある
  # 攻撃者は任意のRubyコードを実行させることが可能になる
  begin
    result = eval(expression)
    "Result: #{result}"
  rescue StandardError => e
    status 500
    "Error: #{e.message}"
  end
end

# 実行方法:
# 1. このファイルを保存
# 2. ターミナルで `ruby demo/eval_vulnerability.rb` を実行
# 3. ブラウザで `http://localhost:4567/calculate?expression=2%2B2` にアクセスすると "Result: 4" が表示される。
# 4. 悪意のある入力を与える例: `http://localhost:4567/calculate?expression=system('ls%20-l')`
#    サーバー側で `ls -l` コマンドが実行されてしまう可能性がある。