# frozen_string_literal: true

require 'sinatra'

# オープンリダイレクトの脆弱性を含むデモコード
# ユーザーからの入力（URL）を検証せずにリダイレクト先に指定している例

get '/redirect' do
  # ユーザーからの入力 (url) を取得
  redirect_url = params['url']

  # 取得した入力をそのままリダイレクト先に指定
  # ここにオープンリダイレクトの脆弱性がある
  redirect redirect_url
end

# 実行方法:
# 1. このファイルを保存
# 2. ターミナルで `ruby demo/open_redirect_vulnerability.rb` を実行
# 3. ブラウザで `http://localhost:4567/redirect?url=https://malicious-site.example.com` にアクセス
#    悪意のあるサイトにリダイレクトされてしまう。
#    フィッシング詐欺などに悪用される可能性がある。